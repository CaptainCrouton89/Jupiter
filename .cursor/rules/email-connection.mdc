---
description: 
globs: 
alwaysApply: false
---
# Email Connection Flow

This document describes the components and flow for connecting email accounts in Jupiter Mail.

## Key Components

- **[ConnectAccountPage](mdc:app/accounts/connect/page.tsx)**: Main page for connecting new email accounts
- **[EmailConnectionForm](mdc:components/email/EmailConnectionForm.tsx)**: Form component for entering email connection details
- **[EmailSetupHelp](mdc:components/email/EmailSetupHelp.tsx)**: Help dialog with connection settings for popular email providers

## Connection Flow

1. User navigates to `/accounts/connect`
2. User chooses connection method:
   - OAuth (Google or Microsoft)
   - Manual IMAP/SMTP

### OAuth Connection
- Initiated via `handleInitiateOAuth` in [ConnectAccountPage](mdc:app/accounts/connect/page.tsx)
- Redirects to `/api/auth/{provider}/initiate?next=/accounts`
- After successful OAuth, user is redirected back to `/accounts`

### Manual Connection
1. User enters email credentials in [EmailConnectionForm](mdc:components/email/EmailConnectionForm.tsx)
2. User can test connection via `onTestConnection` handler
3. On form submission, credentials are sent to `/api/email/save-account`
4. User is redirected to `/accounts` on success

## Help & Documentation
The [EmailSetupHelp](mdc:components/email/EmailSetupHelp.tsx) component provides:
- Detailed IMAP/SMTP settings for Gmail
- Detailed IMAP/SMTP settings for Outlook
- General guidance for other email providers
- Troubleshooting tips
- Links to official documentation

## Form Implementation Notes
- Form validation via React Hook Form and Zod schema
- Password visibility toggle
- Optional account name (defaults to email address if not provided)
- Security type selection (SSL/TLS, STARTTLS, None)
- Test connection functionality before final submission
